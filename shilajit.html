<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Desintoxícate y obtén más energía</title>
  <meta name="description" content="Desde que despertamos empezamos a contaminar nuestro organismo." />
  <meta name="keywords" content="Shilahit Detox: tratamiento natural desintoxicante. Resultados desde el primer mes. Compra con envío rápido y pago a contra entrega." />

  <!-- Preload imagen hero (prioritaria para LCP) -->
  <link rel="preload" as="image" href="https://desintoxica.renovexenlinea.com/imageneswebp/imagen1.webp" fetchpriority="high">

  <!-- Fuentes (no bloqueantes) -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" as="style" onload="this.rel='stylesheet'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  </noscript>

<!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};


  ttq.load('D42GBURC77U4F6VQIKVG');
  ttq.page();
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->

  <style>
    :root{
      --red:#0c8b08; --red-dark:#0a6f06; --gold:#ffb300; --black:#0b0b0b;
      --surface:#111; --card:#151515; --muted:#b8c0cc;
      --ok:#10b981; --warn:#f59e0b; --ring:#ffffff22;
    }
    *{box-sizing:border-box}
    html,body{height:100%;scroll-behavior: smooth;}
    body{margin:0;background:linear-gradient(180deg,#0b0b0b,#121212 60%,#0b0b0b);color:#eaeaea;font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:2px;overflow-x:hidden}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:100%;display:block;margin:0 1px;box-shadow:1px 1px 8px rgba(0,0,0,0.4);border-bottom:3px solid #fff;border-top:3px solid #fff}

    /* Botones */
    .btn{display:inline-flex;gap:.6rem;align-items:center;justify-content:center;padding:14px 22px;border-radius:999px;background:var(--red);font-weight:700;letter-spacing:.2px;width:100%;color:#fff;transition:.2s;margin:16px 2px;animation:heartbeat 1.5s ease-in-out infinite both;cursor:pointer}
    h3{animation:heartbeat 2.5s ease-in-out infinite both;} 
    .btn:hover{background:var(--red-dark);transform:translateY(-1px)}
    .btn.outline{background:transparent;border:1px solid #ffffff33;animation:none}
    .contenedorbtn{display:flex;justify-content:center;margin-top:-20px;margin-bottom:-20px}
    .contenedorbtn .btn{position:fixed;bottom:6px;left:0;right:0;margin:0 auto;justify-content:center;background:red;gap:0 6px;padding:2px 6px;max-width:335px;z-index:9999}
    .contenedorbtn .btn span{color:yellow;font-size:23px}
    .llamado{font-size:1.2rem;font-weight:800}

    /* Modal */
    .modal-overlay{display:none;position:fixed;inset:0;background:#000a;backdrop-filter:blur(4px);align-items:center;justify-content:center;z-index:10000;padding:16px}
    .modal-overlay.active{display:flex}
    .modal{width:min(960px,100%);max-height:92vh;overflow:auto;background:#0e0e0e;border:1px solid rgba(255,255,255,0.08);border-radius:16px;box-shadow:0 30px 80px #000c}
    .modal header{top:0;background:#0e0e0ef2;padding:16px 18px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-between;align-items:center}
    .modal h3{margin:0;font-size:1.4rem}
    .modal .close{background:transparent;border:0;color:#fff;font-size:1.6rem;cursor:pointer;line-height:1}
    .modal .body{padding:18px}
    .modal .footer{padding:16px;border-top:1px solid rgba(255,255,255,0.06);display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end}

    /* Ofertas */
    .offers{display:grid;grid-template-columns:1fr;gap:12px;margin:12px 0 8px}
    .offer-card{display:grid;grid-template-columns:92px 1fr auto;gap:12px;align-items:center;padding:12px;border:1px solid rgba(255,255,255,0.05);border-radius:14px;background:#101010;cursor:pointer;transition:.18s}
    .offer-card:hover{border-color:rgba(255,255,255,0.14);transform:translateY(-2px)}
    .offer-card.active{outline:2px solid var(--red);box-shadow:0 0 0 4px rgba(255,255,255,0.06) inset}
    .offer-img{width:100%;height:100%;display:flex;align-items:center;justify-content:center; }
    .offer-title{font-weight:700}
    .offer-badge{display:inline-flex;align-items:center;gap:6px;font-size:.75rem;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.06);margin-left:6px}
    .badge-hot{background:#1e3a8a;color:#fff;border-color:transparent}
    .badge-save{background:#cf27dd;color:#fff;border-color:transparent;padding:3px 16px}
    .price{display:flex;flex-direction:column;align-items:flex-end}
    .price .compare{color:#94a3b8;text-decoration:line-through;font-size:.9rem}
    .price .current{font-size:1rem;font-weight:800}
    .totals{display:grid;gap:6px;padding:12px;border:1px dashed rgba(255,255,255,0.06);border-radius:12px;background:#0b0b0b;margin:8px 0 14px}
    .row{display:flex;justify-content:space-between;gap:12px}
    .row strong{font-weight:800}
    .muted{color:#a8b0b8;font-weight:400;font-size:.95rem}

    /* Layout */
    header.hero{position:relative;overflow:hidden;max-width:1200px;margin:-4px auto}
    header.hero img{width:100%;height:auto;display:block;object-fit:cover;content-visibility:auto;contain-intrinsic-size:600px}
    main{max-width:1100px;margin:4px auto;padding:0 2px}

    /* Form */
    #orderForm{padding:18px;display:grid;gap:14px;background:transparent}
    #orderForm div{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .in{width:100%;margin-top:6px;padding:12px 14px;border:1px solid #ffffff10;background:#0f0f0f;border-radius:12px;color:#eaeaea;outline:none}
    .in:focus{border-color:var(--gold);box-shadow:0 0 0 4px var(--ring)}
    label{display:block;font-weight:600}
    .error{border-color:#ef4444!important}
    #totalsBox{grid-template-columns: 1fr 1fr !important; .row{text-align: center;}}

    /* Input con ícono */
    .field{position:relative;display:block}
    .field .ico{position:absolute;left:12px;top:50%;transform:translateY(-50%);width:18px;height:18px;opacity:.8;pointer-events:none;color:#b8c0cc}
    .in.with-ico{padding-left:44px}

    /* Toast */
    .toast{text-align: center; position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-10px);background:linear-gradient(90deg,#10b981,#059669);color:#fff;padding:12px 18px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.6);opacity:0;pointer-events:none;transition:opacity .25s ease, transform .25s ease;z-index:11000;font-weight:700}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:auto}

    /* Timer */
    .timer{display:flex;gap:0;justify-content:center;align-items:center;flex-wrap:wrap;width:30%}
    .timer .box{padding:2px;display:flex;flex-wrap:wrap;justify-content:center;align-items:center}

    /* ===== Carrusel de videos ===== */
    .video-carousel {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      max-width: 420px;
      margin: 0 auto 40px;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      background: #0f0f0f;
    }
    .carousel-track {
      display: flex;
      transition: transform 0.4s ease;
      touch-action: pan-y;
    }
    .carousel-item {
      flex: 0 0 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .carousel-item video {
      width: 90%;
      height: auto;
      aspect-ratio: 9 / 16;
      border: 2px solid #fff;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(0,0,0,0.6);
      background-color: #000;
    }
    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: #0c8b0896;
      border: none;
      color: #fff;
      font-size: 2rem;
      cursor: pointer;
      padding: 4px 10px;
      border-radius: 50%;
      z-index: 10;
      transition: background 0.2s ease;
      -webkit-animation: slide-left 3s cubic-bezier(0.250, 0.460, 0.450, 0.940) infinite both;
              animation: slide-left 3s cubic-bezier(0.250, 0.460, 0.450, 0.940) infinite both;
    }
    @-webkit-keyframes slide-left {
      0% { -webkit-transform: translateX(0); transform: translateX(0); }
      100% { -webkit-transform: translateX(-5px); transform: translateX(-5px); }
    }
    @keyframes slide-left {
      0% { -webkit-transform: translateX(0); transform: translateX(0); }
      100% { -webkit-transform: translateX(-5px); transform: translateX(-5px); }
    }
    .carousel-btn.prev { left: 8px; }
    .carousel-btn.next { right: 8px; }

    @media (max-width: 600px) {
      .video-carousel { max-width: 95%; }
      .carousel-btn { font-size: 1.6rem; }
    }

    @media (max-width:980px){
      #orderForm div{grid-template-columns:1fr;gap:12px}
      .offer-card{grid-template-columns:62px 1fr auto}
    }

    @keyframes heartbeat {
      from {transform: scale(1)}
      10% {transform: scale(0.91)}
      17% {transform: scale(0.98)}
      33% {transform: scale(0.87)}
      45% {transform: scale(1)}
    }
  </style>
</head>
<body>

  <header class="hero">
    <img src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen1.webp" alt="Shilahit Detox" fetchpriority="high" decoding="async" width="1200" height="675">
  </header>

  <main>
    <!-- ===== CARRUSEL DE VIDEOS ===== -->
    <span style="font-size: 40px; -webkit-text-stroke-width: 1px; -webkit-text-stroke-color: #000000; color: #3bb90e; text-align: center; display: block; width: 100%; font-weight: 700;">ESTO DICEN</span>
    <h3 style="text-align: center; font-size: 30px; color: #ffff00; line-height: 27px; -webkit-text-stroke-width: 1px; -webkit-text-stroke-color: #ff0000;margin-top: -15px;">Expertos  y Pacientes</h3>

    <section class="video-carousel">
      <button class="carousel-btn prev" aria-label="Anterior">❮</button>
      <div class="carousel-track">
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/presentacioncomboshilajit.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/comboshilajit.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/shilajit2.0.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/gancho2.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/gancho1.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/gancho3.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/gancho4.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/gancho5.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/shilajith90.mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/WhatsApp Video 2025-10-27 at 08.49.06 (1).mp4" playsinline controls></video></div>
        <div class="carousel-item"><video src="https://desintoxica.renovexenlinea.com/videos/WhatsApp Video 2025-10-27 at 08.49.06.mp4" playsinline controls></video></div>
      </div>
      <button class="carousel-btn next" aria-label="Siguiente">❯</button>
    </section>

    <img src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen2.webp" alt="Producto Shilahit">
    <img src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen3.webp" alt="Beneficios Shilahit">
    <img loading="lazy" decoding="async" src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen4.webp" alt="">
    <img loading="lazy" decoding="async" src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen5.webp" alt="">
    <img loading="lazy" decoding="async" src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen6.webp" alt="">
    <img loading="lazy" decoding="async" src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen7.webp" alt="">
    <img loading="lazy" decoding="async" src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen8.webp" alt="">
    <img loading="lazy" decoding="async" src="https://desintoxica.renovexenlinea.com/imageneswebp/imagen9.webp" alt="" style="margin-bottom:150px">

    <div class="contenedorbtn">
      <a href="#checkout" class="btn" id="openCheckout" role="button">
        <span class="llamado">Obtener Oferta</span>
        <div class="timer" style="margin:0">
          <div style="width:90%;text-align:center"><span style="font-size:.9rem;color:#fff">Finaliza en</span></div>
          <div class="box"><div id="t-h" style="font-size:0.9rem">00</div></div>:
          <div class="box"><div id="t-m" style="font-size:0.9rem">59</div></div>:
          <div class="box"><div id="t-s" style="font-size:0.9rem">48</div></div>
        </div>
      </a>
    </div>
  </main>

  <!-- ===== MODAL DE OFERTAS ===== -->
  <div class="modal-overlay" id="checkoutModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal" role="document">
      <header>
        <div>
          <h3 id="modalTitle">Elige tu oferta</h3>
          <div class="muted" id="modalSubtitle">Recuerda que pagas al recibir</div>
        </div>
        <button class="close" id="closeCheckout" aria-label="Cerrar">×</button>
      </header>

      <div class="body">
        <!-- Selector de ofertas --> <a href="#orderForm">
        <div class="offers" id="offerList">
          <div class="offer-card" data-offer="Compra 1" data-qty="1" data-price="89900" tabindex="0">
            <div class="offer-img"><img loading="lazy" src="https://desintoxica.renovexenlinea.com/imageneswebp/detoxsolo.webp" alt="Shilahit 1 frasco" style="box-shadow:none;border:none;"></div>
            <div>
              <div class="offer-title">Solo Desintoxica</div>
              <div class="muted">1 Shilahit Detox (90 tabletas)</div>
              <span class="offer-badge badge-hot">Oferta</span>
            </div>
            <div class="price"><span class="current">$89.900</span></div>
          </div>

          <div class="offer-card" data-offer="Compra 1 + Virilex -50%" data-qty="2" data-price="149900" tabindex="0">
            <div class="offer-img"><img loading="lazy" src="https://desintoxica.renovexenlinea.com/imageneswebp/detoxh90.webp" alt="Shilahit x2" style="box-shadow:none;border:none;"></div>
            <div>
              <div class="offer-title">Desintoxica y Restaura</div>
              <div class="muted">1 Shilahit Detox + Shilahit H90</div>
              <span class="offer-badge badge-hot">Soy Hombre</span>
            </div>
            <div class="price">
              <span class="compare">$180.000</span>
              <span class="current">$149.900</span>
            </div>
          </div>

          <div class="offer-card" data-offer="Compra 2 + 1 GRATIS" data-qty="3" data-price="149900" tabindex="0">
            <div class="offer-img"><img loading="lazy" src="https://desintoxica.renovexenlinea.com/imageneswebp/detoxm90.webp" alt="Shilahit 2+1" style="box-shadow:none;border:none;"></div>
            <div>
              <div class="offer-title">Desintoxica y Restaura</div>
              <div class="muted">1 Shilahit Detox + Shilahit M90</div>
              <span class="offer-badge badge-save">Soy Mujer</span>
            </div>
            <div class="price">
              <span class="compare">$180.000</span>
              <span class="current">$149.900</span>
            </div>
          </div>
        </div></a>

        <!-- Formulario -->
        <form id="orderForm" class="glass" novalidate>
          <!-- Honeypot -->
          <input type="text" name="website" id="hp" style="position:absolute;left:-9999px;top:-9999px" tabindex="-1" autocomplete="off" aria-hidden="true">

          <div>
            <label>Nombre y Apellidos
              <span class="field">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5Z"/></svg>
                <input required name="name" type="text" placeholder="Tu nombre completo" class="in with-ico" maxlength="80">
              </span>
            </label>

            <label>WhatsApp
              <span class="field">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24 11.36 11.36 0 0 0 3.56.57 1 1 0 0 1 1 1v3.59a1 1 0 0 1-1 1A16 16 0 0 1 3 5a1 1 0 0 1 1-1h3.6a1 1 0 0 1 1 1 11.36 11.36 0 0 0 .57 3.56 1 1 0 0 1-.24 1.01Z"/></svg>
                <input required name="phone" type="tel" inputmode="numeric" placeholder="3xx xxx xxxx" class="in with-ico" maxlength="13">
              </span>
            </label>
          </div>

          <div>
            <label>Departamento
              <span class="field">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Zm0 9.5A2.5 2.5 0 1 1 14.5 9 2.5 2.5 0 0 1 12 11.5Z"/></svg>
                <select required name="state" class="in with-ico">
                  <option value="" selected disabled>Selecciona</option>
                  <option>Amazonas</option><option>Antioquia</option><option>Arauca</option><option>Atlántico</option>
                  <option>Bolívar</option><option>Boyacá</option><option>Caldas</option><option>Caquetá</option><option>Casanare</option><option>Cauca</option><option>Cesar</option>
                  <option>Chocó</option><option>Córdoba</option><option>Cundinamarca</option><option>Guainía</option><option>Guaviare</option><option>Huila</option><option>La Guajira</option>
                  <option>Magdalena</option><option>Meta</option><option>Nariño</option><option>Norte de Santander</option><option>Putumayo</option><option>Quindío</option><option>Risaralda</option>
                  <option>San Andrés y Providencia</option><option>Santander</option><option>Sucre</option><option>Tolima</option><option>Valle del Cauca</option><option>Vaupés</option><option>Vichada</option>
                </select>
              </span>
            </label>

            <label>Ciudad / Municipio
              <span class="field">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a6 6 0 0 0-6 6c0 3.87 6 10 6 10s6-6.13 6-10a6 6 0 0 0-6-6Zm0 8a2 2 0 1 1 2-2 2 2 0 0 1-2 2Z"/></svg>
                <input required name="city" type="text" placeholder="Ej. Bogotá, Medellín" class="in with-ico" maxlength="60">
              </span>
            </label>
          </div>

          <label>Dirección de entrega
            <span class="field">
              <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 3 2 12h3v8h6v-5h2v5h6v-8h3Z"/></svg>
              <input required name="address" type="text" placeholder="Calle 00 # 00-00, apto, barrio" class="in with-ico" maxlength="120">
            </span>
          </label>

          <!-- (Opcional) select qty oculto, ya NO se usa para enviar -->
          <div style="display:none">
            <label style="display:none;">Cantidad
              <select name="qty" class="in">
                <option>1 Shilahit</option>
                <option>2 frascos</option>
                <option>3 frascos</option>
              </select>
            </label>
          </div>

          <!-- NUEVO: qty como hidden seguros -->
          <input type="hidden" name="qty" id="qtyField" value="">
          <input type="hidden" name="qty_num" id="qtyNumField" value="">

          <label style="display:flex;gap:10px;align-items:flex-start">
            <input type="checkbox" required name="terms" style="accent-color:var(--red)">
            <span class="muted">Acepto la política de tratamiento de datos y autorizo el contacto para coordinar el envío.</span>
          </label>

          <div class="totals" id="totalsBox" aria-live="polite">
            <div class="row"><span>Total</span><strong id="totalPrice">$0</strong></div>
            <div class="row"><span>Envío</span><strong class="accent">Gratis</strong></div>
          </div>

          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button type="submit" id="submitBtn" class="btn">
              <span class="btn-text">Confirmar pedido</span>
            </button>
          </div>

          <div id="formMsg" class="muted" role="status" aria-live="polite" style="margin-top:8px"></div>

          <!-- Valores ocultos de oferta para fallback -->
          <input type="hidden" name="offer" value="Compra 1">
          <input type="hidden" name="offer_price" value="150000">
        </form>

        <div id="formMount"></div>
      </div>

      <div class="footer">
        <small class="muted">Protegemos tus datos. Usamos la información únicamente para gestionar tu pedido.</small>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">✅ Pedido enviado correctamente</div>

  <!-- JS -->
  <script>
    (function(){
      // URL del webhook (versión sin upsell)
      const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyOG04I29wnuZzo-7dm0qy-4y1tJOn235WzBXC9REJgADYiUM4PsPvEy4Vs0l_ICg6k/exec";

      // Elements
      const modal = document.getElementById('checkoutModal');
      const closeBtn = document.getElementById('closeCheckout');
      const cta = document.getElementById('openCheckout');
      const offerCards = Array.from(document.querySelectorAll('.offer-card'));
      const totalPrice = document.getElementById('totalPrice');
      const form = document.getElementById('orderForm');
      const formMsg = document.getElementById('formMsg');
      const submitBtn = document.getElementById('submitBtn');
      const toast = document.getElementById('toast');

      let selectedOffer = null;

      // Helpers
      function showToast(text){ toast.textContent = text; toast.classList.add('show'); setTimeout(()=> toast.classList.remove('show'), 3000); }
      function formatCOP(n){ try { return n.toLocaleString('es-CO',{style:'currency',currency:'COP',maximumFractionDigits:0}); } catch(e){ return '$' + n; } }

      // Abrir/cerrar modal principal
      function openCheckout(e){ if(e) e.preventDefault(); modal.classList.add('active'); modal.setAttribute('aria-hidden','false'); document.body.classList.add('modal-open'); }
      if (cta){ ['click','touchstart'].forEach(ev=> cta.addEventListener(ev, openCheckout, {passive:false})); }
      document.querySelectorAll('a[href="#checkout"], a[href="#oferta"], [data-open-modal]').forEach(el=>{
        ['click','touchstart'].forEach(ev=> el.addEventListener(ev, openCheckout, {passive:false}));
      });
      function closeModal(){ modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); document.body.classList.remove('modal-open'); }
      closeBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ closeModal(); } });

      // Oculta select qty si existiera (legacy)
      const qtySelect = form.querySelector('select[name="qty"]');
      if (qtySelect) { const qtyLabel = qtySelect.closest('label'); if (qtyLabel) qtyLabel.style.display = 'none'; }

      // Helpers de qty
      function qtyLabelFromQ(q){
        if (q === 1) return '1 Shilajit Detox';
        if (q === 2) return '1 Shilajit Detox + 1 H90';
        if (q === 3) return '1 Shilajit Detox + 1 M90';
        return `${q} productos`;
      }

      // Selección de oferta
      function selectOffer(card){
        offerCards.forEach(c=>c.classList.remove('active')); 
        card.classList.add('active');

        const price = Number(card.dataset.price)||0;
        const q = parseInt(card.dataset.qty, 10) || 1;

        // Total solo por oferta
        totalPrice.textContent = formatCOP(price);

        // Fallbacks ocultos
        const offerInput = form.querySelector('input[name="offer"]') || (()=>{const i=document.createElement('input');i.type='hidden';i.name='offer';form.appendChild(i);return i;})();
        const priceInput = form.querySelector('input[name="offer_price"]') || (()=>{const i=document.createElement('input');i.type='hidden';i.name='offer_price';form.appendChild(i);return i;})();

        offerInput.value = card.dataset.offer;
        priceInput.value = String(price);

        // Setea qty seguros
        const qtyField = document.getElementById('qtyField');
        const qtyNumField = document.getElementById('qtyNumField');
        if (qtyField) qtyField.value = qtyLabelFromQ(q);
        if (qtyNumField) qtyNumField.value = String(q);

        if (qtySelect) qtySelect.value = qtyLabelFromQ(q);

        selectedOffer = { offer: card.dataset.offer, qty: q, price };
      }
      offerCards.forEach(c=>{
        c.addEventListener('click', ()=> selectOffer(c));
        c.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); selectOffer(c); } });
      });
      // Preselección
      selectOffer(offerCards[0]);

      // Envío directo (sin upsell)
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        formMsg.textContent = "";
        if (form.website && form.website.value !== "") return; // honeypot

        // Validación
        const required = ['name','phone','state','city','address'];
        const invalid = [];
        required.forEach(k=>{
          const el = form.querySelector('[name="'+k+'"]');
          if (!el || !el.value.trim() || !el.checkValidity()) invalid.push(k);
        });
        if (invalid.length){
          formMsg.textContent = "Por favor completa todos los campos correctamente.";
          showToast("Completa los campos requeridos");
          invalid.forEach(k=>{ const el = form.querySelector('[name="'+k+'"]'); if (el) el.classList.add('error'); });
          return;
        }
        if (!selectedOffer){
          formMsg.textContent = "Selecciona una oferta antes de continuar.";
          showToast("Selecciona una oferta");
          return;
        }

        try{
          submitBtn.disabled = true;
          const originalBtnText = submitBtn.querySelector('.btn-text')?.textContent || submitBtn.textContent;
          if (submitBtn.querySelector('.btn-text')) submitBtn.querySelector('.btn-text').textContent = "Enviando pedido...";

          // Campos qty seguros
          const qtyField = document.getElementById('qtyField');
          const qtyNumField = document.getElementById('qtyNumField');

          // Total solo con la oferta
          const totalFromUI = parseInt(
            (document.getElementById('totalPrice')?.textContent || '').replace(/[^\d]/g, ''),
            10
          ) || 0;

          const data = {
            name: form.name.value,
            phone: form.phone.value,
            state: form.state.value,
            city: form.city.value,
            address: form.address.value,

            qty: (qtyField?.value || ''),
            qty_num: Number(qtyNumField?.value || 0),

            // Oferta elegida
            offer: selectedOffer.offer,
            offer_price: selectedOffer.price,

            // Sin upsell (compatibilidad con backend)
            upsell_type: 'Ninguno',
            upsell_price: 0,

            // Total final
            total_price: totalFromUI
          };

          await fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          });

          // Éxito
          formMsg.textContent = "✅ Pedido enviado correctamente. Pronto te contactaremos.";
          showToast("✅ Pedido enviado correctamente");
          form.reset();
          totalPrice.textContent = "$0";
          if (modal.classList.contains('active')) { modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); document.body.classList.remove('modal-open'); }

          if (submitBtn.querySelector('.btn-text')) submitBtn.querySelector('.btn-text').textContent = originalBtnText;
          submitBtn.disabled = false;
        } catch (err){
          console.error(err);
          formMsg.textContent = "❌ Hubo un error al enviar. Intenta nuevamente.";
          showToast("❌ Error al enviar");
          if (submitBtn.querySelector('.btn-text')) submitBtn.querySelector('.btn-text').textContent = "Confirmar pedido";
          submitBtn.disabled = false;
        }
      });

      // Limpia error al tipear
      form.querySelectorAll('.in').forEach(input => input.addEventListener('input', ()=> input.classList.remove('error')));

      // Lazy visible (opcional)
      if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver(entries=>{ entries.forEach(e=>{ if (e.isIntersecting) e.target.classList.add('visible'); }); }, { threshold:0.2 });
        document.querySelectorAll('img[loading="lazy"]').forEach(img=>observer.observe(img));
      }
    })();

    // ===== Contador 3h persistente por sesión =====
    const LS_KEY = 'zipper_countdown_end';
    const threeHours = 3*60*60*1000;
    let end = parseInt(localStorage.getItem(LS_KEY),10);
    if (!end || end < Date.now()) { end = Date.now() + threeHours; localStorage.setItem(LS_KEY, String(end)); }
    const th = document.getElementById('t-h'), tm = document.getElementById('t-m'), ts = document.getElementById('t-s');
    setInterval(()=>{
      const left = Math.max(0, end - Date.now());
      const h = String(Math.floor(left/3.6e6)).padStart(2,'0');
      const m = String(Math.floor(left%3.6e6/6e4)).padStart(2,'0');
      const s = String(Math.floor(left%6e4/1e3)).padStart(2,'0');
      th.textContent=h; tm.textContent=m; ts.textContent=s;
    },500);

    // ===== Carrusel de videos con reproducción del activo =====
    const track = document.querySelector('.carousel-track');
    const items = document.querySelectorAll('.carousel-item');
    const prevBtn = document.querySelector('.carousel-btn.prev');
    const nextBtn = document.querySelector('.carousel-btn.next');

    let currentIndex = 0;
    let userInteracted = false; // evita que el primer video se reproduzca solo

    function updateCarousel() {
      track.style.transform = `translateX(-${currentIndex * 50}%)`;

      // Si el usuario ya interactuó, reproducir el video actual y pausar los demás
      if (userInteracted) {
        items.forEach((item, i) => {
          const video = item.querySelector('video');
          if (i === currentIndex) {
            video.currentTime = 0;
            video.play().catch(() => {}); // evita error si autoplay bloqueado
          } else {
            video.pause();
          }
        });
      }
    }

    function nextVideo() {
      userInteracted = true;
      currentIndex = (currentIndex + 1) % items.length;
      updateCarousel();
    }

    function prevVideo() {
      userInteracted = true;
      currentIndex = (currentIndex - 1 + items.length) % items.length;
      updateCarousel();
    }

    nextBtn.addEventListener('click', nextVideo);
    prevBtn.addEventListener('click', prevVideo);

    // Deslizamiento táctil (swipe)
    let startX = 0;
    track.addEventListener('touchstart', e => startX = e.touches[0].clientX, {passive:true});
    track.addEventListener('touchend', e => {
      const diff = e.changedTouches[0].clientX - startX;
      if (Math.abs(diff) > 50) {
        userInteracted = true;
        if (diff < 0) nextVideo();
        else prevVideo();
      }
    });
  </script>
</body>
</html>


